# 피크월(거래량 기준)

## 목표
   이것의 목표는 손오공과 같이 특정 월에 몰리는 거래량을 가진 종목을 찾아서 매매할떄 참고하기 위함이다.   
   연도별 분기, 연도별 월, 연도별 주 단위로 구분하여 거래량이 몰리는 연도별 단위의 피크점를 찾은 후에 전체연도의 단위의 피크점과 연도별 단위의 피크점의 백분율을 구하여 백분율 순위 출력하기.

---

## 주요 용어
* 단위 구분   
  * 연도별 분기 quarter by year
  * 연도별 월 month by year
  * 연도별 주 weeks by year
* 단위의 피크점 unit peak

---



## 피크월 계산 방법

  1. 장열림 테이블에 거래일이 해당연도의 몇주, 몇 분기에 해당하는지 구한다.
  2. 종목의 같은 연도의 거래일을 (주/월/분기)단위로 묶어 거래량 합을 구한다.
     1. 종목의 해당연도의 일자에 해당하는 주가 몇번째 주인지 구하기
     2. 해당연도의 단위별 거래량 합 구하기
  3. 같은연도의 (주/월/분기)단위별 합의 값으로 같은연도의 단위별 평균값, 평균이하값들, 평균 이상값들, 최저, 최고 값을 구한다.
     1. 평균이하값들, 평균 이상값들에서 연결성의 존재 여부를 찾는다.

  4. 전체년도의 주단위 ***빈도분석*** : 전체연도로 놓고 연도별 최고거래량인 주, 최소거래량인 주, 평균거래량보다 큰 목록의 주, 평균거래량 보다 작은 목록의 주가 몇 퍼센트를 찾는다.
     1. 연도별 종목의 주단위 거래량의 빈도 분석

   추가 ? ) 특정연도의 단위별 최고가를 찾는다고 한다면 최고가 1등과 2등의 차이가 1밖에 없다면 ?? 그래서 배열이 필요함.
      전체연도에서 각자의 연도에서 뽑은 최고와 최저값이 각자의 연도별로 다르겠지? 그래서 각자연도별 최고저값이  전체 연도에서 몇퍼센트를 차지하는지 구하기?
   


---















## 테이블

   1. 빈도 테이블 
      | 종목id | 최고거래량인 주 | 최고거래량인 주의 퍼센트 | 최소거래량인 주 | 최소거래량인 주의 퍼센트 | 평균 최소 범위 | 평균 최소 범위의 퍼센트 | 평균 최대 범위 | 평균 최대 범위의 퍼센트 |
      | ------ | --------------- | ------------------------ | --------------- | ------------------------ | -------------- | ----------------------- | -------------- | ----------------------- |

   2. 연도별 집계 테이블
      | 종목id | 단위(주/분기/월) | 연도 | 최고거래량인 단위값(주/분기/월)| 최소거래량인 단위값(주/분기/월) | 평균 이상의 단위값(주/분기/월) 목록 | 평균 이하의 단위값(주/분기/월) 목록 |
      | ------ | ---------------- | ---- | --------------- | --------------- | ------------------- | ------------------- |

   3. 주별 테이블 
      1. 저장소 낭비
         1. 2000(종목수) * (종목별)전체년도 수 * 52(주) 의 줄 발생
         2. rdb말고 nosql db로 한다면?
         
      2. 연도 파티션 테이블
      
      | 종목id | 연도 | 주  | 거래량의 합 |
      | ------ | ---- | --- | ----------- |

---











  

## 실행계획

      빈도가 의미 있는 정보가 되기 위한 필요한 조건은 데이터들이 다 채워져야 한다.
      최소 단위의 데이터가 다 채워 지면 실행시키는게 맞다 .
      최소 단위의 데이터가 채워지기 전에 실행한다면 퍼센트값만 조금더 떨어질뿐.

   - 거래량단위 빈도 분석 티커 생성
     - 데이터 쓰기 티커 종료 후 실행
     - 금일이 단위(주/월)의 마지막인지 체크.
     - 마지막이라면 프로그램 실행.  stock-project-이름
       - 기존 프로세스에서 어플리케이션 단위로 빼기
       - stock-project-이름
         - 종목별 마지막 계산 단위 저장 ex) 2016-1주차 , 2015-11월
         - 종목별 마지막 계산 단위 이후 의 데이터를 db에서 조회
           - 마지막 부터 연도별로 단위별 끊어서 가져와 연도별 단위의 평균,고저,고저 목록을 알아 낸후 저장
         - 빈도 계산
           - 종목의 전체 연도를 가지고 퍼센트를 계산
         
     - 주단위로 계산후 db 업데이트
       - 어플별 database 생성?
         - proejct-이름 생성
         - rdb말고 no sql 쓸까? 
         - ? 오늘이 이번연도의 3주차의 마지막 날이라면 어떻게 계산이 되야 할까? 단위가 연도별 인데?
         - 
   
  ---
  





## 구체적인 방법
1. vscode를 켠다. 
2. 쿼리를 짠다.
   1. meta.code에 해당되는 tb_monthly_peek의  기준칼럼(마지막 저장일)을 찾아서 계산해서 넣기
      1. meta.code와 tb_monthly_peek의 기준칼럼(마지막 저장일)을 조회
         1. table 생성 tb_monthly_peek tbmp, tb_monthly_peek_volume tbmpv
            1. 차이점: 
               1. tbmp는 매일 업데이트된 tbmpv의 거래럍을 가지고 정보를 도출한다.
               2. tbmpv는 단순히 매일 거래량을 업데이트한다.  
         2. tbmp     => 종목의 연도별 피크월, 사용자 조회= 마지막 테이블 
         3. tbmpv    => 년도의 월별 거래량합, tb_monthly_peek의 보조
            1. 종목코드, 년도, 월, 거래량, 마지막계산일
            2. 장마감시 거래량 업데이트 용


         4. 매일 tb_mpv의 년도의 월에 vol 추가하고
         5. tb_mp에 종목의 해당년도의 값 업데이트 하기.
         6. 
      2. 시작기준 부터 hist.price 조회
      3. 조회 결과 golang으로 계산
      4. insert
3. 맞나 확인한다.
4. 테이블 저장: 코드의 전체년도의 피크월 존재, 피크월, 주변월, 전체월.json{월: 퍼센트} 
5. 뷰 저장: select count(피크월) group by 피크월  count 가 1이면 피크윌이 공통값.   
    where row수가  1이 아니것의 의미는 => 여러 년도를 비교한것. 그러므로 조회에서 로우수도 조회

---
## 계산 범위
현재 입력된 달은 매일 갱신.   
매일 테이블을 갱신 시켜줌. 해당년도의 달만.    
하루에 2번 실행 될 되도 문제없게.  

---


## 실행시작
가격다 넣고 반등 계산하고.   
종목별 마지막 가격일 조회 해서 가격일 갱신하면 이전 피크월은 계산이 안됨.   

피크월 테이블 기준으로 시작하기 vs 가격 테이블 기준 시작하기   
종목의 마지막 년도 피크월이 있으면? ( 년도포함월 칼럼추가. )    

---